version: 2

sources:
  - name: bronze
    schema: bronze
    tables:
      - name: users_cdc
        description: "Raw CDC events after JSON parsing (Bronze layer)."
        columns:
          - name: id
            description: "Internal surrogate key generated by ingestion (if present)."
          - name: user_id
            description: "UUID of the user from source system."
            tests:
              - not_null
          - name: gender
            description: "User gender."
          - name: first_name
            description: "User first name."
          - name: last_name
            description: "User last name."
          - name: email
            description: "User email address."
          - name: password
            description: "Password hash or bcrypt value."
          - name: dob
            description: "Date of birth as YYYY-mm-dd if provided."
          - name: dob_days
            description: "Debezium numeric DOB (days since epoch). Used for conversion."
          - name: phone
            description: "Primary phone number."
          - name: cell
            description: "Mobile phone number."
          - name: picture_large
            description: "Large profile picture URL."
          - name: picture_medium
            description: "Medium profile picture URL."
          - name: picture_thumbnail
            description: "Thumbnail picture URL."
          - name: city
            description: "User's reported city."
          - name: state
            description: "State name from source JSON."
          - name: state_id
            description: "Raw state identifier from source."
          - name: postcode
            description: "Zip / postal code."
          - name: latitude
            description: "Latitude from geo section."
          - name: longitude
            description: "Longitude from geo section."
          - name: created_at
            description: "Original created_at timestamp from source."
          - name: ingested_at
            description: "Timestamp when CDC event was ingested."

      - name: matches_cdc
        description: "CDC stream for user matches (Debezium)"
        columns:
          - name: event_id
            description: "Unique CDC event identifier"
          - name: op
            description: "CDC operation type (c, u, d, r)"
          - name: cdc_ts_ms
            description: "Debezium event timestamp in milliseconds"
          - name: source_db
            description: "Source database name"
          - name: source_schema
            description: "Source schema name"
          - name: source_table
            description: "Source table name"
          - name: source_tx_id
            description: "Source transaction ID"
          - name: user1
            description: "First user involved in the match"
          - name: user2
            description: "Second user involved in the match"
          - name: created_at
            description: "Original record creation timestamp"
          - name: ingested_at
            description: "Timestamp when record was ingested into bronze"

      - name: actions_cdc
        description: "CDC stream for user actions (likes, dislikes, etc.)"
        columns:
          - name: event_id
            description: "Unique CDC event identifier"
          - name: op
            description: "CDC operation type (c, u, d, r)"
          - name: cdc_ts_ms
            description: "Debezium event timestamp in milliseconds"
          - name: source_db
            description: "Source database name"
          - name: source_schema
            description: "Source schema name"
          - name: source_table
            description: "Source table name"
          - name: source_tx_id
            description: "Source transaction ID"
          - name: user_id
            description: "User who performed the action"
          - name: target_id
            description: "Target user of the action"
          - name: action
            description: "Action type (like, dislike, etc.)"
          - name: created_at
            description: "Original record creation timestamp"
          - name: ingested_at
            description: "Timestamp when record was ingested into bronze"